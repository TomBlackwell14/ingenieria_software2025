{% extends "base.html" %}
{% load static %}
{% block title %}Iniciar sesion · Cencosud Gases Free!{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/role_login.css' %}">
{% endblock %}

{% block content %}
<div class="page">

  <!-- COLUMNA IZQUIERDA -->
  <section class="brand vcenter">
    <header class="brand-head">
      <span class="brand-pill">🍃</span>
      <h1>Cencosud Gases Free!</h1>
    </header>

    <p class="brand-sub">Gestion y seguimiento de Carbono Neutralidad</p>

    <!-- DECORACIÓN (OLAS) -->
    <svg class="waves near" viewBox="0 0 600 200" preserveAspectRatio="none" aria-hidden="true">
      <path d="M0,140 C120,190 240,90 360,140 C480,190 540,120 600,150 L600,200 L0,200 Z"/>
      <path d="M0,150 C130,110 230,200 360,150 C470,110 530,170 600,150 L600,200 L0,200 Z"/>
    </svg>

    <!-- BENEFICIOS / FUNCIONES -->
    <div class="benefits">
      <article class="benefit">
        <span class="b-ico">✅</span>
        <div>
          <h4>Inventario GEI unificado</h4>
          <p>Consolidacion por pais, sede y alcance.</p>
        </div>
      </article>

      <article class="benefit">
        <span class="b-ico">🧭</span>
        <div>
          <h4>Simulador normativo</h4>
          <p>Evalua cumplimiento vs. politicas y metas.</p>
        </div>
      </article>

      <article class="benefit">
        <span class="b-ico">📤</span>
        <div>
          <h4>Reportes y exportaciones</h4>
          <p>Descargas para auditorias y presentaciones.</p>
        </div>
      </article>
    </div>

    <!-- MINI INDICADORES -->
    <div class="mini-stats">
      <div class="mini-card">
        <small>CO₂ evitado (YTD)</small>
        <strong>12.4 kt</strong>
      </div>
      <div class="mini-card">
        <small>Progreso a meta 2030</small>
        <strong>41 %</strong>
      </div>
    </div>
  </section>

  <!-- COLUMNA DERECHA: LOGIN -->
  <section class="card vcenter right login-card">
    <header class="card-header">
      <h3>Iniciar sesion</h3>
      <small>Selecciona tu rol para continuar</small>
    </header>

    <div class="roles-grid" id="roles">
      <button class="role" type="button" data-role="director">
        <div class="role-top">
          <span class="icon">🎯</span>
          <span class="check">✓</span>
        </div>
        <h4>Director</h4>
        <p>Vision estrategica y aprobacion global</p>
      </button>

      <button class="role" type="button" data-role="analista">
        <div class="role-top">
          <span class="icon">📊</span>
          <span class="check">✓</span>
        </div>
        <h4>Analista Ambiental</h4>
        <p>Coordinacion y supervision de operaciones</p>
      </button>

      <button class="role" type="button" data-role="operador">
        <div class="role-top">
          <span class="icon">🔧</span>
          <span class="check">✓</span>
        </div>
        <h4>Operario</h4>
        <p>Ejecucion de tareas operativas</p>
      </button>

      <button class="role" type="button" data-role="ciudadano">
        <div class="role-top">
          <span class="icon">🧑‍🤝‍🧑</span>
          <span class="check">✓</span>
        </div>
        <h4>Ciudadano</h4>
        <p>Acceso publico a informacion</p>
      </button>
    </div>

    <button id="go" class="btn primary" disabled>Iniciar sesion</button>

    <div class="links">
      <a href="/accounts/password_reset/">¿Has perdido la contrasena?</a>
    </div>

    <div class="bubbles" aria-hidden="true"></div>
  </section>
</div>

<!-- SCRIPT DE SELECCIÓN DE ROL -->
<script>
(function(){
  let selected = null;
  const roles = document.querySelectorAll('.role');
  const btn = document.getElementById('go');

  roles.forEach(r => {
    r.addEventListener('click', () => {
      roles.forEach(x => x.classList.remove('active'));
      r.classList.add('active');
      selected = r.getAttribute('data-role');
      btn.disabled = false;
    });
  });

  btn.addEventListener('click', () => {
    if (!selected) return;
    if (selected === 'ciudadano') {
      window.location.href = '/dashboard/ciudadano/';
      return;
    }
    const next = encodeURIComponent(`/dashboard/${selected}/`);
    window.location.href = `/accounts/login/?next=${next}`;
  });
})();
</script>
{% endblock %}
